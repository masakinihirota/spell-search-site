# 実装計画

- [x] 1. 基本的な型定義とインターフェースの作成
  - [x] SongMatchingResult、MatchingCache、SpellMatchingMap型を定義
  - [x] 初期キャッシュ（所持歌数0）用の型定義
  - [x] バックグラウンド計算用の型定義
  - _要件: 1.1, 2.1, 3.1_

- [x] 2. 歌マッチング計算ロジックの実装
  - [x] 2.1 songMatchingCalculatorユーティリティの作成
    - [x] calculateSongMatching関数の実装
    - [x] getMissingDigits関数の実装
    - [x] getMatchingPercentage関数の実装
    - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3_

  - [x] 2.2 計算ロジックの単体テスト作成
    - [x] 基本的なマッチング計算のテスト
    - [x] エッジケース（空文字列、重複数字）のテスト
    - [x] パーセンテージ計算精度のテスト
    - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3_

- [x] 3. バックグラウンド計算とキャッシュシステムの実装
  - [x] 3.1 SpellMatchingCacheマネージャーの作成
    - [x] アプリ起動時に所持歌数0の初期キャッシュを事前計算・保存
    - [x] 全呪文データを読み込み、所持歌との照合結果をメモリに保存
    - [x] デバウンス機能付��バックグラウンド計算（0.5秒待機後実行）
    - [x] Map<spellId, SongMatchingResult>形式でのキャッシュ管理
    - _要件: 3.1, 3.2_

  - [x] 3.2 usePossessionManagerフックの実装
    - [x] 所持歌の状態管理
    - [x] デバウンス付き所持歌変更時のキャッシュ再構築トリガー
    - [x] キャッシュ更新の進行状況管理
    - [x] 連続変更時の無駄な計算防止
    - _要件: 3.1, 3.2_

- [x] 4. SongMatchingDisplayコンポーネントの実装
  - [x] 4.1 基本的な表示機能の実装
    - [x] spellIdを受け取り、キャッシュから結果を取得して表示
    - [x] 計算不要の高速表示実装
    - [x] 所持歌数字、不足数字、マッチング率の表示
    - _要件: 3.3, 4.1, 6.1, 6.2_

  - [x] 4.2 視覚的フィードバック機能の実装
    - [x] マッチング率に応じた背景色変更
    - [x] 100%マッチ時の特別表示（太い枠線）
    - _要件: 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 6.3, 6.4_

  - [x] 4.3 テーマ対応の実装
    - [x] ダークモード・ライトモード対応
    - [x] テーマ切り替え時の自動更新
    - _要件: 5.1, 5.2, 5.3_

- [x] 5. 呪文リストへのマッチング表示統合
  - [x] 5.1 既存の呪文リストコンポーネントの調査
    - [x] ���在の呪文リスト実装の確認
    - [x] 統合ポイントの特定
    - _要件: 1.1, 2.1, 3.1, 4.1_

  - [x] 5.2 呪文リストにSongMatchingDisplay統合
    - [x] 各呪文アイテムにマッチング表示を追加
    - [x] 右上配置でのレイアウト調整
    - _要件: 3.3, 4.1_

  - [x] 5.3 所持歌データとの連携実装
    - [x] 所持歌リスト更新時の自動反映
    - [x] データ同期の確保
    - _要件: 3.2_

- [ ] 6. 所持リストへのマッチング表示統合
  - [ ] 6.1 既存の所持リストコンポーネントの調査
    - 現在の所持リスト実装の確認
    - 統合ポイントの特定
    - _要件: 6.1, 6.2_

  - [ ] 6.2 所持リストにSongMatchingDisplay統合
    - 各所持アイテムにマッチング表示を追加
    - 呪文リストと同じ形式での表示
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ] 6.3 所持リスト更新時の自動反映実装
    - 所持リスト更新時のマッチング情報更新
    - リアルタイム同期の確保
    - _要件: 6.5_

- [ ] 7. エラーハンドリングとバリデーションの実装
  - [ ] 7.1 入力検証機能の実装
    - 数字以外の文字の自動除去
    - 空文字列の適切な処理
    - 重複数字の処理
    - _要件: 1.1, 2.1_

  - [ ] 7.2 エラー状態���理の実装
    - SongMatchingError型を使用したエラー処理
    - エラー回復機能の実装
    - _要件: 全般_

- [ ] 8. パフォーマンス最適化の実装
  - [ ] 8.1 バックグラウンド計算の最適化
    - Web Workerを使用した非同期計算（オプション）
    - 大量呪文データの効率的な処理
    - _要件: 全般_

  - [ ] 8.2 レンダリング最適化の実装
    - React.memoによるSongMatchingDisplayの最適化
    - キャッシュヒット時の即座表示
    - _要件: 全般_

- [ ] 9. 統合テストの実装
  - [ ] 9.1 コンポーネント間連携テスト
    - 所持データ更新時の表示同期テスト
    - テーマ切り替え時の色彩更新テスト
    - _要件: 3.2, 5.3, 6.5_

  - [ ] 9.2 E2Eテストの実装
    - 所持歌入力から表示更新までのシナリオテスト
    - 呪文リストと所持リストでの一貫性テスト
    - _要件: 全般_

- [ ] 10. 最終的な統合と動作確認
  - [ ] 10.1 全機能の統合テスト
    - 呪文リストでのマッチング表示確認
    - 所持リストでのマッチング表示確認
    - データ同期の確認
    - _要件: 全般_

  - [ ] 10.2 ユーザビリティテスト
    - 実際のゲームデータでの動作確認
    - パフォーマンステ��ト
    - 視覚的フィードバックの確認
    - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_